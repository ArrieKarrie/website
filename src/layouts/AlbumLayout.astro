---
import BaseLayout from './BaseLayout.astro';
import BlurredOverlay from "../components/BlurredOverlay.astro";
import PaddedPage from "../layouts/PaddedPage.astro";
import Nav from "../components/Nav.astro";
import MenuIcons from "../components/MenuIcons.astro";
import Name from "../components/Name.astro";

import AlbumViewer from "../components/AlbumViewer.astro";
import Lightbox from "../components/Lightbox.astro";

const { frontmatter } = Astro.props; 
const { title, heroImage, featuredImages, heroPosition } = frontmatter;
---

<BaseLayout title={`AvD Photography | ${title}`}>
    <PaddedPage>
        <div id="albumGrid">
            <Name/>
            <Nav/>
            <MenuIcons/>
            
            <div id="texts" class="flex flex-col">
                <div id="title" class="text-[var(--color-text-primary-light)] dark:text-[var(--color-text-primary-dark)] text-[min(5svw,10.5svh)] pt-[min(1.4svw,2.828svh)] shrink-0">{title}</div>
                
                <div id="description" class="w-[50%] grow overflow-hidden mask-fade relative cursor-grab active:cursor-grabbing">
                    <div id="descriptionContent">
                        <slot/> 
                    </div>
                </div>
            </div>
            
            <AlbumViewer 
                title={title} 
                heroImage={heroImage} 
                featuredImages={featuredImages}
                heroPosition={heroPosition} 
            />

        </div>

        <Lightbox images={featuredImages} />

    <BlurredOverlay/>
    </PaddedPage>
</BaseLayout>

<script>
    import { initLenis } from '../utils/lenis';

    document.addEventListener('astro:page-load', () => {
        const wrapper = document.getElementById('description') as HTMLElement | null;
        const content = document.getElementById('descriptionContent') as HTMLElement | null;

        if (wrapper && content) {
            // One-line setup using the shared utility
            const lenis = initLenis({ wrapper, content });

            document.addEventListener('astro:before-swap', () => {
                lenis.destroy();
            }, { once: true });
        }
    });
</script>

<style>
    /* --- LOCAL ELEMENTS --- */
    #title {
        font-weight: 200;
        letter-spacing: -0.05em;
    }

    #texts {
        font-size: min(1svw, 2.02svh);
        grid-area: texts;
        position: relative;
        z-index: 5;
        height: 100%;
        overflow: hidden;
    }

    /* --- DESCRIPTION --- */
    #description {
        will-change: transform;
    }

    #descriptionContent {
        padding-bottom: min(3.8svw, 7.68svh); 
    }

    /* The Fade Effect */
    .mask-fade {
        mask-image: linear-gradient(to bottom, black 85%, transparent 100%);
        -webkit-mask-image: linear-gradient(to bottom, black 85%, transparent 100%);
    }

    /* --- GRID LAYOUT --- */
    #albumGrid {
        height: 100%;                       
        width: 100%;                        
        display: grid;                     
        grid-template-columns: 52% 23% 25%;
        grid-template-rows: 4% 92% 4%;
        grid-template-areas: 
            "name nav menuIcons"
            "texts heroImage heroImage"
            "tip heroImage heroImage"; 
        overflow: hidden; 
    }

    #albumGrid > :global(#name)      { grid-area: name; }
    #albumGrid > :global(#nav)       { grid-area: nav; }
    #albumGrid > :global(#menuIcons) { grid-area: menuIcons; }
    #albumGrid > :global(#heroImage) { grid-area: heroImage; }


    /* --- RESPONSIVE --- */
    @media (max-aspect-ratio: 3.1/4) {
        #albumGrid {
            grid-template-columns: 50% 50%;
            grid-template-rows: 4% 55% 37% 4%; 
            grid-template-areas: 
                "name menuIcons" 
                "heroImage heroImage" 
                "texts texts" 
                "tip tip";
        }

        #texts, #description {
            width: 100%;
        }

        #texts {
            font-size: 2.2svw;
        }

        #title {
            font-size: 11svw;
            padding-top: 3.8svw;
        }
    }
</style>